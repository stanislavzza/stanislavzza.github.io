<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.39">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Eubanks">

<title>Chapter 5: Hierarchical Models – The Kappa Zoo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-f3c2ea88cadbcfb37ba28ffa2c97cfc1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XP6WMESY52"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XP6WMESY52', { 'anonymize_ip': true});
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">The Kappa Zoo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul class="collapse">
  <li><a href="#sec-intro" id="toc-sec-intro" class="nav-link active" data-scroll-target="#sec-intro"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#sec-likelihood" id="toc-sec-likelihood" class="nav-link" data-scroll-target="#sec-likelihood"><span class="header-section-number">2</span> Hierarchical Likelihood</a></li>
  <li><a href="#sec-truth" id="toc-sec-truth" class="nav-link" data-scroll-target="#sec-truth"><span class="header-section-number">3</span> Truth Parameters</a></li>
  <li><a href="#sec-raters" id="toc-sec-raters" class="nav-link" data-scroll-target="#sec-raters"><span class="header-section-number">4</span> Rater Parameters</a></li>
  <li><a href="#sec-units" id="toc-sec-units" class="nav-link" data-scroll-target="#sec-units"><span class="header-section-number">5</span> Units of Likelihood</a>
  <ul class="collapse">
  <li><a href="#likelihood-as-information" id="toc-likelihood-as-information" class="nav-link" data-scroll-target="#likelihood-as-information"><span class="header-section-number">5.1</span> Likelihood as Information</a></li>
  <li><a href="#signal-and-noise" id="toc-signal-and-noise" class="nav-link" data-scroll-target="#signal-and-noise"><span class="header-section-number">5.2</span> Signal and Noise</a></li>
  </ul></li>
  <li><a href="#bayesian-models" id="toc-bayesian-models" class="nav-link" data-scroll-target="#bayesian-models"><span class="header-section-number">6</span> Bayesian Models</a></li>
  <li><a href="#invariant-scales" id="toc-invariant-scales" class="nav-link" data-scroll-target="#invariant-scales"><span class="header-section-number">7</span> Invariant Scales</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 5: Hierarchical Models</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Eubanks </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="sec-intro" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>In <a href="./paradox.html">Chapter 4: The Kappa Paradox</a> we saw how adding parameters can increase the explanatory power of t-a-p models. This is an old idea. The Cohen kappa <span class="citation" data-cites="cohen1960coefficient">(<a href="#ref-cohen1960coefficient" role="doc-biblioref">Cohen, 1960</a>)</span> dates from the 1960s, and for large data sets can be seen as a variation of the Fleiss kappa, but where each rater has a parameter for random assigments. In the original paper, the formula is derived for two rates, but it can be expanded to any number of them. The application of that idea to the three parameter t-a-p model is to create a <span class="math inline">\(p_j\)</span> parameter for each rater <span class="math inline">\(j\)</span>. However, this involves complications, and is treated toward the end of this chapter.</p>
<p>The expansion of model parameters maximally includes coefficients for each rater and subject. For example, we could assign a truth parameter <span class="math inline">\(t_i\)</span> to each subject <span class="math inline">\(i\)</span>, and accuracy and random assignment parameters <span class="math inline">\(a_j\)</span> and <span class="math inline">\(p_j\)</span>, respectively, to each rater <span class="math inline">\(j\)</span>. The latter requires that we have IDs for the raters. Generally, regression models like this are called hierarchical models or random effects models or fixed effects models, depending on the research tradition (As noted in <span class="citation" data-cites="agresti2003categorical">Agresti (<a href="#ref-agresti2003categorical" role="doc-biblioref">2003</a>)</span>, p.&nbsp;523 and <span class="citation" data-cites="gelman2006data">Gelman &amp; Hill (<a href="#ref-gelman2006data" role="doc-biblioref">2006</a>)</span>, p.&nbsp;245, fixed versus random effects are not good descriptions for Bayesian models).</p>
<p>The three parameter t-a-p model is <em>already</em> hierarchical in the sense that the ratings for each subject are clustered for analysis. That’s how we create a distribution of agreement to compare with a binomial mixture. The hierarchical model we’re discussing in this chapter is a further extension of that idea, where we add parameters to the model, generally for one of two reasons. One reason is to increase model fit by accounting for variation in the data that is not explained by the three average parameters. The other reason is to obtain estimates for individual subjects or raters.</p>
<p>Individual rater parameters and subject truth values are of interest in many contexts. In educational psychology, we might want to know how well a teacher is able to assess student learning, and how well the students demonstrate knowledge or skill. In medical research, we might want to know how well a doctor is able to diagnose a disease, and how well the patients are responding to treatment. In machine learning, we may be concerned with the quality of training data drawn from human classifications. The ratings of consumer products on sites like Amazon or Yelp can be polluted with unfaithful reviews, so some means of detection is valuable. Likewise, individual subject truth parameters are valuable if we want to make decisions with the rating data, for example in a medical diagnosis, a pass/fail assessment of student learning, or using product ratings to make a selection.</p>
</section>
<section id="sec-likelihood" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Hierarchical Likelihood</h1>
<p>So far we have relied on using the rated subject as a unit of analysis (the hierarchical element just mentioned). This approach averages out differences in raters, so that we are in effect assuming all the raters are the same. That assumption allows for an efficient method of calculating likelihood for each subject and accumulating it as a way to fit the parameters. From <a href="./tapmodel.html">Chapter 2: The t-a-p Model</a>, we have</p>
<p><span id="eq-efficient-likelihood"><span class="math display">\[
\begin{aligned}
\ell(t,a,p; &amp; R_1, \dots, R_N, k_1, \dots,k_N) = \\
&amp; \sum_{u = 1}^{\text{unique}(R_i,k_i)}n_u \left[ \log \left( t\,\text{binom}(R_u,k_u,a + \bar{a}p) +  \bar{t}\,\text{binom}(R_u,k_u,\bar{a}p) \right)  \right].\\
\end{aligned}
\tag{1}\]</span></span></p>
<p>The log-likelihood function sums over each unique combination of raters <span class="math inline">\(R_u\)</span> and Class 1 ratings <span class="math inline">\(k_u\)</span>, with count <span class="math inline">\(n_u\)</span>. The values for <span class="math inline">\(R_u\)</span>, <span class="math inline">\(k_u\)</span>, and <span class="math inline">\(n_u\)</span> come from counting the ratings in the data. The <span class="math inline">\(n_u\)</span> count sums up how many subjects have the same combination of raters and Class 1 ratings <span class="math inline">\((R_u,k_u)\)</span>. Assuming there is no other ways to distinguish subjects, the three empirical values <span class="math inline">\(R_u\)</span>, <span class="math inline">\(k_u\)</span>, and <span class="math inline">\(n_u\)</span> are all we have to distinguish one subject from another. Since truth values are subject-dependent (not rater dependent), the distributional form of a binomial mixture puts the <span class="math inline">\(t\)</span> outside the binomial distribution function in the likelihood. Without changing much, we could imagine replacing the average <span class="math inline">\(t\)</span> with individual parameters, which with the arguments on the left hidden in <span class="math inline">\(\cdot\)</span>, is</p>
<p><span id="eq-likelihood-t_u"><span class="math display">\[
\begin{aligned}
\ell(\cdot) &amp;= \sum_{u = 1}^{\text{unique}(R_i,k_i)}n_u \left[ \log \left( t_u\,\text{binom}(R_u,k_u,a + \bar{a}p) +  \bar{t_u}\,\text{binom}(R_u,k_u,\bar{a}p) \right)  \right],\\
\end{aligned}
\tag{2}\]</span></span></p>
<p>where <span class="math inline">\(t_u\)</span> now indexes a truth parameter for subjects that have the same number of raters and Class 1 ratings, the unique <span class="math inline">\((R_u,k_u)\)</span> pairs. Note that one of the terms <span class="math inline">\(\text{binom}(R_u,k_u,a + \bar{a}p)\)</span> and <span class="math inline">\(\text{binom}(R_u,k_u,\bar{a}p)\)</span> will usually be larger than the other, so if we maximize likelihood with <span class="math inline">\(t_u\)</span> as a free parameter, the optimization will push these truth probabilities toward binary values. Recall that we assumed binary truth in the general t-a-p model. As a demonstration of that using MCMC estimation <a href="./hierarchical-demo-1.html">see the demo</a>. However, assuming that the collection of cases with the same <span class="math inline">\(R_u\)</span> and <span class="math inline">\(k_u\)</span> values are have the same class is unrealistic. In the next section we’ll consider values for the <span class="math inline">\(t_u\)</span> parameters that average over subjects.</p>
<p>If we consider individual rater parameters, as with the Cohen kappa, we can’t use the formulation of the likelihood function in <a href="#eq-efficient-likelihood" class="quarto-xref">Equation&nbsp;1</a>, because the raters are not usually clustered in the same way as the subjects. Computing the probability of a combination <span class="math inline">\((R_u,k_u)\)</span> when raters do not have a common accuracy or random assignment parameter is more complex.</p>
<p>If we abondon the binomial form and consider each rating as a unit of analysis, the log likelihood function for an assignment of raters and their characteristics to ratings is</p>
<p><span id="eq-likelihood-rating"><span class="math display">\[
\begin{aligned}
\ell_{\text{rating}}(\cdot) &amp;= \sum_{i,j} C_{ij}\log \left( t_ia_j + \bar{a_j}p_j \right)  + \\
&amp; \sum_{i,j}\bar{C_{ij}}\log \left( 1- t_ia_j - \bar{a_j}p_j \right).
\end{aligned}
\tag{3}\]</span></span></p>
<p>The sum is over all ratings, and the <span class="math inline">\(t_i\)</span>, <span class="math inline">\(a_j\)</span>, and <span class="math inline">\(p_j\)</span> parameters are indexed by subject and rater. Here, <span class="math inline">\(C_{ij}\)</span> is the binary classification assigned by rater <span class="math inline">\(j\)</span> to subject <span class="math inline">\(i\)</span>, and <span class="math inline">\(\bar{C_{ij}}\)</span> is the opposite classification. Since each rater only assigns a single rating to a subject, exactly one of <span class="math inline">\(C_{ij}\)</span> and <span class="math inline">\(\bar{C_{ij}}\)</span> will be non-zero. In contrast to the combinatoric formulation in <a href="#eq-efficient-likelihood" class="quarto-xref">Equation&nbsp;1</a>, we’re summing over both the ratings of Class 0 and Class 1 (not just counts of Class 1), and since raters are now identified and matched to ratings, the factor <span class="math inline">\(\binom{R}{k}\)</span> is gone. I’ll refer to this variation as <strong>rating</strong> likelihood, since we accumulate over each rating instead of over each subject, as with <a href="#eq-efficient-likelihood" class="quarto-xref">Equation&nbsp;1</a>.</p>
</section>
<section id="sec-truth" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Truth Parameters</h1>
<p>The t-a-p model assumes that in the unknowable background, there are “latent” binary states <span class="math inline">\(T_i \epsilon  \{0,1\}\)</span> for each subject <span class="math inline">\(i\)</span>. The average truth parameter <span class="math inline">\(t\)</span> is the estimated proportion of subjects that are in Class 1 in truth. How much can we know about the <span class="math inline">\(T_i\)</span>’s in hierarchical models?</p>
<p>In t-a-p models with average <span class="math inline">\(a\)</span> and <span class="math inline">\(p\)</span> we can only distinguish subjects by the number of raters and Class 1 ratings each recieves. This is the <span class="math inline">\((R_u, k_u)\)</span> pair in <a href="#eq-efficient-likelihood" class="quarto-xref">Equation&nbsp;1</a>. Suppose we now imagine an average truth parameter <span class="math inline">\(t_u\)</span> for each of these combinations. The conditional probability that the true class of subject <span class="math inline">\(i\)</span> is 1 (notated <span class="math inline">\(T_i = 1\)</span>) given that the number of Class 1 ratings for that subject is <span class="math inline">\(k_u\)</span> out of <span class="math inline">\(R_u\)</span> total ratings is</p>
<p><span id="eq-class1-prob"><span class="math display">\[
\begin{aligned}
Pr[T_i = 1|N_r = R_u, N_c = k_u] &amp;= \frac{Pr[T_i = 1]Pr[N_c = k_u|T_i = 1, N_r = R_u]}{ Pr[N_c = k_u]} \\
&amp;= \frac{t\,\text{Binom}(R_u,k_u,a+\bar{a}p)}{t\,\text{Binom}(R_u,k_u,a+\bar{a}p) + \bar{t}\,\text{Binom}(R_u,k_u,\bar{a}p)},
\end{aligned}
\tag{4}\]</span></span></p>
<p>where <span class="math inline">\(N_r\)</span> and <span class="math inline">\(N_c\)</span> are placeholders for number of raters and Class 1 ratings, respectively.</p>
<p>For illustration, simulated ratings of ten raters with <span class="math inline">\(t= .5\)</span>, <span class="math inline">\(a = .6\)</span> and <span class="math inline">\(p = .3\)</span> are shown in <a href="#fig-sample-distro" class="quarto-xref">Figure&nbsp;1</a>. The plot shows the distribution of the number of Class 1 ratings <span class="math inline">\(k\)</span> out of 10 for true Class 1 cases, with the binomial mixture distribution overlaid.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Illustrate a t-a-p binomial mixture distribution of Class 1 Counts</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> .<span class="dv">6</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> .<span class="dv">3</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>pr_c0 <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>a)<span class="sc">*</span>p </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>pr_c1 <span class="ot">&lt;-</span> a <span class="sc">+</span> pr_c0</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>distr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">N_c =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Pr[k|C0]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dbinom</span>(N_c, <span class="dv">10</span>, pr_c0),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Pr[k}C1]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">dbinom</span>(N_c, <span class="dv">10</span>, pr_c1),</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Pr[C1|k]</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Pr[k}C1]</span><span class="st">`</span><span class="sc">/</span>(<span class="st">`</span><span class="at">Pr[k|C0]</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">Pr[k}C1]</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">gather</span>(Class, Probability, <span class="sc">-</span>N_c)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>distr <span class="sc">|&gt;</span> </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> N_c, <span class="at">y =</span> Probability, <span class="at">color =</span> Class)) <span class="sc">+</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of Class 1 Ratings"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-sample-distro" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sample-distro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="hierarchical_files/figure-html/fig-sample-distro-1.png" class="img-fluid figure-img" width="432">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sample-distro-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Sample distribution of Class 1 ratings counts, with <span class="math inline">\(t= .5\)</span>, <span class="math inline">\(a = .6\)</span> and <span class="math inline">\(p=.3\)</span>. The green and blue lines show the density functions for true Class 0 and Class 1 cases, respecitvely. The red line shows the probability of a Class 1 subject given the number of Class 1 ratings received.
</figcaption>
</figure>
</div>
</div>
</div>
<p>The green and blue lines in <a href="#fig-sample-distro" class="quarto-xref">Figure&nbsp;1</a> trace the distribution of Class 1 ratings out of ten for true Class 0 and Class 1 cases, respectively. The bump in the blue line to the right is because true Class 1 cases are likely to get more Class 1 assignments, since the accuracy is reasonably high. The most likely outcome for a true Class 0 subject is only one Class 1 rating (green line above <span class="math inline">\(k = 1\)</span>). The red line answers the question “given that we see <span class="math inline">\(k\)</span> Class 1 ratings, what is the probability that the subject is Class 1 in truth?” This is the conditional probability denoted <span class="math inline">\(Pr[C_1|k]\)</span>. At <span class="math inline">\(k=4\)</span>, meaning a subject got four Class 1 classifications from raters and six of Class 0, it’s more than 50% likely that the subject is Class 1, but it’s close to a coin flip. With fewer than four Class 1 ratings, it’s much more likely that the subject is Class 0.</p>
<p>The conditional probabilities in red in <a href="#fig-sample-distro" class="quarto-xref">Figure&nbsp;1</a> can be used as estimates for <span class="math inline">\(t_u\)</span> in <a href="#eq-likelihood-t_u" class="quarto-xref">Equation&nbsp;2</a> by first estimating the average t-a-p coefficients and then applying the conditional probability formula for each combination of raters and ratings.</p>
</section>
<section id="sec-raters" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Rater Parameters</h1>
<p>Suppose that we estimate the <span class="math inline">\(t_u\)</span> parameters as just described, and that we have rater IDs in the data set. Then for each rater we can create a confusion matrix of the ratings they assigned verus the estimated true class probabilities. From <a href="./introduction.html">Chapter 1</a> we have the following average rates in the table, where the average true Class 1 rate <span class="math inline">\(t\)</span> has been replaced with <span class="math inline">\(t_u\)</span> and average <span class="math inline">\(a\)</span> and <span class="math inline">\(p\)</span> are now specific to rater <span class="math inline">\(j\)</span>.</p>
<div id="tbl-tap-confusion" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-tap-confusion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: The confusion matrix for a combination of raters <span class="math inline">\(R\)</span> and Class 1 ratings <span class="math inline">\(k\)</span> applied rater <span class="math inline">\(j\)</span>. Terms in parentheses are inaccurate ratings. TPR = true positive rate, etc.
</figcaption>
<div aria-describedby="tbl-tap-confusion-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 27%">
<col style="width: 47%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>True C1</th>
<th>True C0</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Classified C1</td>
<td>TPR <span class="math inline">\(= t_ua_j + (t_u\bar{a}_jp_j)\)</span></td>
<td>FPR <span class="math inline">\(=(\bar{t}_u\bar{a}_jp_j)\)</span></td>
</tr>
<tr class="even">
<td>Classified C0</td>
<td>FNR <span class="math inline">\(=(t_u\bar{a}_j\bar{p}_j)\)</span></td>
<td>TNR <span class="math inline">\(=\bar{t}_ua_j + (\bar{t}_u\bar{a}_j\bar{p}_j)\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Given the estimated <span class="math inline">\(t_u\)</span> values and rater-identified ratings, we can populate the estimated probabilities in the confusion matrix in <a href="#tbl-tap-confusion" class="quarto-xref">Table&nbsp;1</a>, and then use algebra to solve for the <span class="math inline">\(a_j\)</span> and <span class="math inline">\(p_j\)</span> parameters, with</p>
<p><span class="math display">\[
\begin{aligned}
a_j &amp;= \text{TPR}/t_u - \text{FPR}/\bar{t}_u \\
p_j &amp;= \frac{\text{FPR}}{\bar{a}_j\bar{t}_u}.
\end{aligned}
\]</span></p>
<p>To illustrate, I’ll try this out on the PTSD data set.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ptsd)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>raw_ratings <span class="ot">&lt;-</span> ptsd</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get the ratings for question 2</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>formatted_ratings <span class="ot">&lt;-</span> tapModel<span class="sc">::</span><span class="fu">format_raw_ratings</span>(raw_ratings,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">rating_cols =</span> <span class="fu">str_c</span>(<span class="st">"Rater "</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">rating_colnames_type =</span> <span class="st">"rater"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">subject_id_col =</span> <span class="st">"SubjectID"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">rater_id_col =</span> <span class="cn">NULL</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prune =</span> <span class="cn">FALSE</span>) </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>ratings <span class="ot">&lt;-</span> formatted_ratings <span class="sc">|&gt;</span> </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Question <span class="sc">==</span> <span class="st">"Q2"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Question) <span class="sc">|&gt;</span> </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  tapModel<span class="sc">::</span><span class="fu">as_binary_ratings</span>(<span class="at">in_class =</span> <span class="st">"2"</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the rating parameters, t_i, a_j, p_j</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>rating_params <span class="ot">&lt;-</span> tapModel<span class="sc">::</span><span class="fu">fit_ratings</span>(ratings)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the rater parameters</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>rating_params <span class="sc">|&gt;</span> </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rater_id) <span class="sc">|&gt;</span> </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">c_j =</span> <span class="fu">mean</span>(rating),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">a_j =</span> <span class="fu">first</span>(a),</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_j =</span> <span class="fu">first</span>(p),</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">bias =</span> <span class="fu">mean</span>(p <span class="sc">-</span> t)) <span class="sc">|&gt;</span> </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(a_j) <span class="sc">|&gt;</span> </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-rater-params" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-rater-params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Rater parameters estimated from the confusion matrix, showing the ID of the rater from the original PTSD data with individual rater statistics: c_j is the rate of class 1 assignments; a_j and p_j are the t-a-p model parameters for this rater; and bias is mean(p_j - t_i).
</figcaption>
<div aria-describedby="tbl-rater-params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">rater_id</th>
<th style="text-align: right;">c_j</th>
<th style="text-align: right;">a_j</th>
<th style="text-align: right;">p_j</th>
<th style="text-align: right;">bias</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Rater 1</td>
<td style="text-align: right;">0.84</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.46</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rater 5</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.96</td>
<td style="text-align: right;">0.42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rater 4</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">0.43</td>
<td style="text-align: right;">0.99</td>
<td style="text-align: right;">0.45</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rater 2</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">-0.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rater 9</td>
<td style="text-align: right;">0.66</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">0.33</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rater 7</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rater 6</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">-0.35</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rater 3</td>
<td style="text-align: right;">0.56</td>
<td style="text-align: right;">0.79</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: right;">0.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rater 8</td>
<td style="text-align: right;">0.59</td>
<td style="text-align: right;">0.84</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">0.33</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rater 10</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.44</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>There is a lot of detailed information in <a href="#tbl-rater-params" class="quarto-xref">Table&nbsp;2</a> that we seem to get for almost free. These estimates suggest that rater 1 was the least accurate because of overestimating Class 1 likelihood and rater 10 the most accurate. Rater 7 had the least estimated classification bias. We’ll continue this discussion in [Chapter 6: Assessing Model Fit)(fit.qmd).</p>
</section>
<section id="sec-units" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Units of Likelihood</h1>
<p>The search for t-a-p model parameters from a set of ratings is done using maximum likelihood estimation. The likelihood function is a product of the probabilities of the observed ratings, given the model parameters. The objective is to find the values of the t-a-p parameters that maximize this product of probabilities. In actual computation, it is not practical to multiply probabilities, because the product of many small numbers will look like zero to a computer. Instead, we take the log of the likelihood function, which turns the product into a sum.</p>
<p>To compute likelihood for a hierarchical model with individual parameters for subjects and raters, we first use <a href="#eq-likelihood-rating" class="quarto-xref">Equation&nbsp;3</a> to compute the log likelihood for each rating given the estimated parameters with</p>
<p><span class="math display">\[
\begin{aligned}
\ell^1_{ij} &amp; := \ell(C=1|t_i,a_j,p_j) = \log(t_ia_j+\bar{a}_jp_j) \\
\ell^0_{ij}  &amp;:=\ell(C=0|t_i,a_j,p_j) = \log (1 - t_ia_j -\bar{a}_jp_j).
\end{aligned}
\]</span> These are the log probabilities that a pair of subject <span class="math inline">\(i\)</span> and rater <span class="math inline">\(j\)</span> will result in a rating of 1 or 0, respectively, given the parameter estimates. The actual ratings are denoted <span class="math inline">\(C^1_{ij}\)</span> and <span class="math inline">\(C^0_{ij}\)</span>, for ratings of one and zero, respectively. The second step is to calculate the cumulative log probability over all raters and ratings using</p>
<p><span class="math display">\[
\ell(\cdot) = \sum_{i,j} C^1_{ij}\ell^1_{ij} + \sum_{i,j} C^0_{ij}\ell^0_{ij}.
\]</span></p>
<p>The classifications <span class="math inline">\(C^1_{ij}\)</span> and <span class="math inline">\(C^0_{ij}\)</span> are distributed as binomial mixtures over subjects for each rater, and in the aggregate will tend toward a bell shape. The multiplication by rater likelihoods and summation of these is similar to a dot project, so the calculation can perhaps be thought of as a kind of projection operator from the data onto the space of parameters. That idea could use further development. Since the <span class="math inline">\(\ell\)</span> coefficients are opinionated about which subjects are Class 1 because of the inclusion of <span class="math inline">\(t_i\)</span> in the calculation, the cumulative likelihood will be maximized when <span class="math inline">\(\ell^1_{ij} &gt; \ell^0_{ij}\)</span> for ratings of 1.</p>
<section id="likelihood-as-information" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="likelihood-as-information"><span class="header-section-number">5.1</span> Likelihood as Information</h2>
<p>Since the ratings are binary, we can use ideas from information theory to make sense of the log likelihood. From <span class="citation" data-cites="shannon1948mathematical">Shannon (<a href="#ref-shannon1948mathematical" role="doc-biblioref">1948</a>)</span>, the amount of information in a binary data stream is <span class="math inline">\(I = x \log_{\frac{1}{2} } x\)</span> per event with probability <span class="math inline">\(x\)</span>, where the information is measured in bits (binary digits). If <span class="math inline">\(x = 1/2\)</span> is the fraction of 1s in the data stream, then <span class="math inline">\(I = \log_{\frac{1}{2} } 1/2= 1\)</span> bit per symbol sent.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>I will use the convention that <span class="math inline">\(\log x\)</span> means <span class="math inline">\(\log_{\frac{1}{2} } x\)</span>, without specifying the base each time. This reads oddly for those used to integer log bases, since the log of any probability with base greater than one is negative. Hence there are a lot of expressions that start with negative signs in the usual likelihood formulations. The advantage of log base 1/2 is that we don’t need the negative signs to get a result in bits. Another important difference is that when we maximize likelihood, we <em>minimize</em> the number of informational bits per rating (again, because of the lack of a minus sign).</p>
</div>
</div>
<p>For a t-a-p model, the average rate of Class 1 assignments is <span class="math inline">\(c = ta + \bar{a}p\)</span>, and heuristically the expected information per rating is hence <span class="math inline">\(I_{tap} = c \log c + \bar{c} \log \bar{c}\)</span>. If all the ratings are of the same type (Class 1, say), the expression becomes zero; no information can be transmitted if the signal never changes. The maximum information rate is when <span class="math inline">\(c = 1/2\)</span>, which is <span class="math inline">\(I_{tap} = 1\)</span> bit per rating.</p>
<p>The information <span class="math inline">\(I_{tap}\)</span> has an approximate relationship to likelihood, which is the probability of seeing the provided data set under the model assumptions. To see that, consider the accumulation of log likelihood <span class="math inline">\(\ell\)</span> by comparing the actual ratings to their probabilities under a given t-a-p model, with a sum over each classification <span class="math inline">\(\hat{C}_{ij}\)</span> by rater <span class="math inline">\(j\)</span> of subject <span class="math inline">\(i\)</span>. From <a href="#eq-likelihood-rating" class="quarto-xref">Equation&nbsp;3</a> we have</p>
<p><span id="eq-ll-information"><span class="math display">\[
\begin{aligned}
\ell_{\text{rating}}(\text{ratings}|\text{model}) &amp;=  \log \prod_{i,j} Pr[C_{ij} = \hat{C}_{ij}] \\
&amp;= \sum_{i,j} \log Pr[C_{ij} = \hat{C}_{ij}] \\
&amp;= \sum_{\hat{C}_{ij}= 1} \log c+ \sum_{\hat{C}_{ij}= 0}  \log \bar{c}\\
&amp; \approx N(c \log c + \bar{c} \log \bar{c}) \\
&amp;= N I_{tap}.
\end{aligned}
\tag{5}\]</span></span></p>
<p>Here, the probability <span class="math inline">\(Pr[C_{ij} = \hat{C}_{ij}]\)</span> in the fitted t-a-p model is <span class="math inline">\(c = ta + \bar{a}p\)</span> when raters assign <span class="math inline">\(\hat{C}_{ij} = 1\)</span> to a subject, and and <span class="math inline">\(\bar{c}\)</span> for <span class="math inline">\(\hat{C}_{ij} = 0\)</span>. <span class="math inline">\(N\)</span> is the number of ratings. If the model represents the data, the fraction of <span class="math inline">\(\hat{C}_{ij}= 1\)</span> is <span class="math inline">\(c\)</span>, and there will be approximately <span class="math inline">\(Nc\)</span> ratings of Class 1. From <a href="#eq-ll-information" class="quarto-xref">Equation&nbsp;5</a> it’s intuitive to compare t-a-p models on the common scale <span class="math inline">\(I_{tap}\)</span>, bits of information per rating. This isn’t technically correct, because unless the ratings are completely random, correlations within subjects interfere with the information stream analogy. We can see this most directly with the likelihood from <a href="#eq-efficient-likelihood" class="quarto-xref">Equation&nbsp;1</a>, where only counts per subject matter. For example, if three out of four raters assign a Class 1 rating with probability <span class="math inline">\(c = 1/2\)</span>, the log likelihood for that subject is</p>
<p><span class="math display">\[
\begin{aligned}
\ell &amp;= \log \binom{4}{1}c^3\bar{c} \\
&amp;= \log 4 + 4 \log \frac{1}{2} \\
&amp;= -2 + 4 = 2 \text{ bits}
\end{aligned}
\]</span></p>
<p>The within-subject variation absorbs half of the four bits that the four ratings nominally provide. A similar effect is present in calculations from <a href="#eq-likelihood-rating" class="quarto-xref">Equation&nbsp;3</a>. If one subject has 1000 raters and another subject has 5, the information of the 1000th rating of the first subject is intuitively less informative than the fifth rating from the second. Similarly, a rating from a rater with accuracy zero isn’t as informative as a rater with accuracy one. Accordingly, for hierarchical models we could consider weighting ratings according to such factors.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Research Project
</div>
</div>
<div class="callout-body-container callout-body">
<p>How might we modify <a href="#eq-likelihood-rating" class="quarto-xref">Equation&nbsp;3</a> to assign weights to ratings according to the relative amount of information provided?</p>
</div>
</div>
<p>In practice, we compute <span class="math inline">\(\ell_{\text{rating}}(\cdot)\)</span> from <a href="#eq-likelihood-rating" class="quarto-xref">Equation&nbsp;3</a>, and then divide by the number of ratings to get the bits per rating to get <span class="math inline">\(I_{tap}\)</span>. This can be done even for the subject-likelihood average t-a-p models computed from <a href="#eq-efficient-likelihood" class="quarto-xref">Equation&nbsp;1</a> by assigning each of the (possibly anonymous) raters the same average accuracy and random assignment parameters.</p>
</section>
<section id="signal-and-noise" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="signal-and-noise"><span class="header-section-number">5.2</span> Signal and Noise</h2>
<p>In addition to splitting the ratings by the rating of 0 or 1 as in <a href="#eq-ll-information" class="quarto-xref">Equation&nbsp;5</a>, we could also split them by their accuracy. With probability <span class="math inline">\(a\)</span> a rating will be accurate, in which case we have an information stream with characteristics determined by <span class="math inline">\(t\)</span>. In the complementary case, it’s determined by <span class="math inline">\(p\)</span>. Then we can sum over the ratings to extract two kinds of information with</p>
<p><span class="math display">\[
\begin{aligned}
I_{\text{signal}} &amp;= \frac{1}{N} \sum_{i,j}^N a_{ij}(t_i \log t_i + \bar{t}_i \log \bar{t}_i) \\
I_{\text{noise}} &amp;= \frac{1}{N} \sum_{i,j}^N \bar{a}_{ij}(p_{ij} \log p_{ij} + \bar{p}_{ij}\log \bar{p}_{ij}).
\end{aligned}
\]</span></p>
<p>Note that for unbiased raters (<span class="math inline">\(t=p= c\)</span>), <span class="math inline">\(I_{\text{signal}} + I_{\text{noise}} = c \log c + \bar{c} \log \bar{c} = I_{tap}\)</span>, but in general the sum of signal and noise won’t equal the average likelihood <span class="math inline">\(I_{tap}\)</span>. The information per bit of two communications channels is not generally additive when we combine them. As an example, a channel of all zeros and a channel of all ones each have zero information, but if we combine the two the result will be positive.</p>
<p>The names “signal” and “noise” are borrowed from communication theory, but they can be misunderstood here. The maximum signal occurs when raters are perfectly accurate and samples are split evenly between true Class 1 and Class 0 cases. It’s not always possible or desirable to have evenly balanced classes, for example with a medical test that detects a rare condition. Such unbalanced data sets are common in ratings (see <a href="./paradox.html">Chapter 4: The Kappa Paradox</a>).</p>
</section>
</section>
<section id="bayesian-models" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Bayesian Models</h1>
<p>One limitation of the approach illustrated in the PTSD example above is that the truth parameters <span class="math inline">\(t_i\)</span> are assumed fixed throughout. Recall that the <span class="math inline">\(t_u\)</span> values, which are unique to each species of rating counts (e.g.&nbsp;3 out of 5 Class 1 ratings), are generated from the average t-a-p ratings. The rater parameters <span class="math inline">\(a_j\)</span> and <span class="math inline">\(p_j\)</span> come from the <span class="math inline">\(t_i\)</span> estimates. Hence, there is bound to be some error in the true Class 1 probabilities. To avoid overfitting, we can introduce a form of regularization, which pushes hierarchical parameter estimates toward a mean. The goal of that approach is increased generalizability, meaning that the parameter estimates obtained describe a wider range of data.</p>
<p>I have done quite a lot of work on the Bayesian approach, and the current tapModel package has functions to implement them, but they’re still a work in progress. I’ll update this page when it’s ready.</p>
</section>
<section id="invariant-scales" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Invariant Scales</h1>
<p>Educational testing has evolved methods of teasing out student ability from test difficulty, and related problems. One method relies on the idea of an “invariant scale,” which is a real-valued metric that applies simultaneously to a test item’s difficulty <span class="math inline">\(d_i\)</span> and student ability to get the correct answer <span class="math inline">\(a_j\)</span>. A simple model might use a sigmoid like the logistic function to model correct answers <span class="math inline">\(c_{ij}\)</span> with</p>
<p><span class="math display">\[
\sigma(c_{ij}) = a_j - d_i.
\]</span> See <span class="citation" data-cites="engelhard2012examining">Engelhard (<a href="#ref-engelhard2012examining" role="doc-biblioref">2012</a>)</span> for such an analysis in the context of rater accuracy. The philosophical trick here is that difficulty and ability are assumed not to be directly observable, but on the same numerical scale so they can be summed without mixing up dimensional units. We can’t directly estimate what fraction of answers were randomly correct. This method has the limitation that we have to know the correct value of each item. That’s not a problem for educational testing, but it is a problem in general for rater classification. Imagine that we have to induce the correct answers from student responses. Then the model might look something like</p>
<p><span class="math display">\[
\sigma(r_{ij}) = t_i + a_j - d_i.
\]</span> where <span class="math inline">\(r_{ij}\)</span> is student <span class="math inline">\(j\)</span>’s yes/no response to item <span class="math inline">\(i\)</span>, and <span class="math inline">\(t_i\)</span> is the probability that this item’s correct respone is encoded as 1. It’s clear that the invariant scale idea can’t hold here. The true answer to a test question is not on the same dimensional scale as its difficulty to get correct. But adding the <span class="math inline">\(t_i\)</span> term is what allows us to distinguish between answers that are correct because of accurate marking and answers that are correct due to lucky inaccurate marks. Splitting up these domains of interest ontologically, we can imagine the three t-a-p model parameters corresponding each to an invariant scale.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-agresti2003categorical" class="csl-entry" role="listitem">
Agresti, A. (2003). <em>Categorical data analysis</em> (Vol. 482). John Wiley &amp; Sons.
</div>
<div id="ref-cohen1960coefficient" class="csl-entry" role="listitem">
Cohen, J. (1960). A coefficient of agreement for nominal scales. <em>Educational and Psychological Measurement</em>, <em>20</em>(1), 37–46.
</div>
<div id="ref-engelhard2012examining" class="csl-entry" role="listitem">
Engelhard, G. (2012). Examining rating quality in writing assessment: Rater agreement, error, and accuracy. <em>Journal of Applied Measurement</em>, <em>13</em>, 321–335.
</div>
<div id="ref-gelman2006data" class="csl-entry" role="listitem">
Gelman, A., &amp; Hill, J. (2006). <em>Data analysis using regression and multilevel/hierarchical models</em>. Cambridge university press.
</div>
<div id="ref-shannon1948mathematical" class="csl-entry" role="listitem">
Shannon, C. E. (1948). A mathematical theory of communication. <em>The Bell System Technical Journal</em>, <em>27</em>(3), 379–423.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>